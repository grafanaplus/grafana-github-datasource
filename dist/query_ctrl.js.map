{"version":3,"sources":["../src/query_ctrl.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAQ,qB,kBAAA,S;;;;;;;;;;;;;;;;;;;;;iDAGK,yB;;;AAET,mDAAY,MAAZ,EAAoB,SAApB,EAA+B,YAA/B,EAA6C,EAA7C,EAAkD;AAAA;;AAAA,6HACxC,MADwC,EAChC,SADgC;;AAG9C,0BAAK,KAAL,GAAa,MAAb;AACA,0BAAK,CAAL,GAAS,EAAT;AACA,0BAAK,YAAL,GAAoB,YAApB;;AAEA,0BAAK,MAAL,CAAY,SAAZ,GAAwB,MAAK,MAAL,CAAY,SAAZ,IAAyB,MAAjD;AACA,0BAAK,MAAL,CAAY,IAAZ,GAAmB,MAAK,MAAL,CAAY,IAAZ,IAAoB,EAAvC;AACA,0BAAK,MAAL,CAAY,IAAZ,GAAmB,MAAK,MAAL,CAAY,IAAZ,IAAoB,EAAvC;AACA,0BAAK,MAAL,CAAY,MAAZ,GAAqB,MAAK,MAAL,CAAY,MAAZ,IAAsB,EAA3C;;AAEA,0BAAK,WAAL,GAAmB,aAAa,kBAAb,CAAgC,MAAK,MAAL,CAAY,IAA5C,EAAkD,mBAAlD,CAAnB;AACA,0BAAK,aAAL,GAAqB,aAAa,kBAAb,CAAgC,MAAK,MAAL,CAAY,MAA5C,EAAoD,eAApD,CAArB;AAb8C;AAcjD;;;;+CAEU;AAAA;;AACP,4BAAG,KAAK,MAAL,CAAY,IAAf,EAAoB;AAChB,iCAAK,UAAL,CAAgB,QAAhB,CAAyB,KAAK,MAAL,CAAY,IAArC,EAA2C,IAA3C,CAAgD,gBAAQ;AACpD,oCAAI,OAAO,KAAK,IAAhB;AACA,uCAAK,MAAL,CAAY,IAAZ,GAAmB,KAAK,KAAxB;AACA,uCAAK,MAAL,CAAY,SAAZ,GAAwB,KAAK,IAA7B;AACH,6BAJD;AAKH;AACJ;;;kDAEa;AACV,+BAAO,CACP,EAAC,OAAO,MAAR,EAAgB,MAAM,MAAtB,EADO,EAEP,EAAC,OAAO,KAAR,EAAe,MAAM,cAArB,EAFO,CAAP;AAIH;;;+CAEU;AACP,+BAAO,KAAK,UAAL,CAAgB,eAAhB,CAAgC,EAAC,SAAS,MAAV,EAAkB,UAAU,KAAK,MAAjC,EAAhC,EACF,IADE,CACG,KAAK,YAAL,CAAkB,mBAAlB,CAAsC,KAAtC,CADH,CAAP;AAEH;;;wDAEmB;AAChB,+BAAO,KAAK,UAAL,CAAgB,eAAhB,CAAgC,EAAC,SAAS,QAAV,EAAoB,UAAU,KAAK,MAAnC,EAAhC,EACF,IADE,CACG,KAAK,YAAL,CAAkB,mBAAlB,CAAsC,KAAtC,CADH,CAAP;AAEH;;;kDAEa;AACV,6BAAK,MAAL,CAAY,IAAZ,GAAmB,KAAK,WAAL,CAAiB,KAApC;AACA,6BAAK,SAAL,CAAe,OAAf,G;AACH;;;2DAEsB;AACnB,6BAAK,MAAL,CAAY,MAAZ,GAAqB,KAAK,aAAL,CAAmB,KAAxC;AACA,6BAAK,SAAL,CAAe,OAAf,G;AACH;;;;cArD0C,S;;;;AAwD/C,sCAA0B,WAA1B,GAAwC,4BAAxC","file":"query_ctrl.js","sourcesContent":["import {QueryCtrl} from 'app/plugins/sdk';\nimport './css/query-editor.css!'\n\nexport class GithubDatasourceQueryCtrl extends QueryCtrl {\n\n    constructor($scope, $injector, uiSegmentSrv, $q)  {\n        super($scope, $injector);\n\n        this.scope = $scope;\n        this.q = $q;\n        this.uiSegmentSrv = uiSegmentSrv;\n\n        this.target.user_type = this.target.user_type || 'User';\n        this.target.user = this.target.user || '';\n        this.target.repo = this.target.repo || '';\n        this.target.metric = this.target.metric || '';\n\n        this.repoSegment = uiSegmentSrv.getSegmentForValue(this.target.repo, 'select repository');\n        this.metricSegment = uiSegmentSrv.getSegmentForValue(this.target.metric, 'select metric');\n    }\n\n    findUser() {\n        if(this.target.user){\n            this.datasource.findUser(this.target.user).then(resp => {\n                let user = resp.data;\n                this.target.user = user.login;\n                this.target.user_type = user.type;\n            });\n        }\n    }\n\n    getUserType() {\n        return [\n        {value: 'user', text: 'User'},\n        {value: 'org', text: 'Organization'}\n        ]\n    }\n\n    getRepos() {\n        return this.datasource.metricFindQuery({'query': 'repo', 'target': this.target})\n            .then(this.uiSegmentSrv.transformToSegments(false));\n    }\n\n    getMetricSegments() {\n        return this.datasource.metricFindQuery({'query': 'metric', 'target': this.target})\n            .then(this.uiSegmentSrv.transformToSegments(false));\n    }\n\n    repoChanged() {\n        this.target.repo = this.repoSegment.value;\n        this.panelCtrl.refresh(); // Asks the panel to refresh data.\n    }\n\n    metricSegmentChanged() {\n        this.target.metric = this.metricSegment.value;\n        this.panelCtrl.refresh(); // Asks the panel to refresh data.\n    }\n}\n\nGithubDatasourceQueryCtrl.templateUrl = 'partials/query.editor.html';\n\n"]}